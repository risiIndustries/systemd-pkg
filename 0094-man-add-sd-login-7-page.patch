From 362fa48aecfac175e3601d4075bbc1eb18684625 Mon Sep 17 00:00:00 2001
From: Lennart Poettering <lennart@poettering.net>
Date: Mon, 19 Dec 2011 13:57:07 +0100
Subject: [PATCH] man: add sd-login(7) page (cherry picked from commit
 01448ff92d9549785242ffab453bf5bcde348c61)

---
 Makefile.am                |   31 +++++++++---
 man/sd-login.xml           |  117 ++++++++++++++++++++++++++++++++++++++++++++
 man/sd_pid_get_session.xml |   19 +++----
 3 files changed, 149 insertions(+), 18 deletions(-)
 create mode 100644 man/sd-login.xml

diff --git a/Makefile.am b/Makefile.am
index c04125e..a5d9c77 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -786,6 +786,7 @@ MANPAGES = \
 	man/daemon.7 \
 	man/sd-daemon.7 \
 	man/sd-readahead.7 \
+	man/sd-login.7 \
 	man/runlevel.8 \
 	man/telinit.8 \
 	man/halt.8 \
@@ -804,7 +805,13 @@ MANPAGES = \
 	man/modules-load.d.5 \
 	man/sysctl.d.5 \
         man/systemd-ask-password.1 \
-        man/systemd-loginctl.1
+        man/systemd-loginctl.1 \
+        man/sd_pid_get_session.3 \
+        man/sd_uid_get_state.3 \
+        man/sd_session_is_active.3 \
+        man/sd_seat_get_active.3 \
+        man/sd_get_seats.3 \
+        man/sd_login_monitor_new.3
 
 if ENABLE_BINFMT
 MANPAGES += \
@@ -817,14 +824,22 @@ MANPAGES_ALIAS = \
 	man/sd_is_socket.3 \
 	man/sd_is_socket_unix.3 \
 	man/sd_is_socket_inet.3 \
+	man/sd_is_mq.3 \
 	man/sd_notifyf.3 \
-        man/sd_pid_get_session.3 \
-        man/sd_uid_get_state.3 \
-        man/sd_session_is_active.3 \
-        man/sd_seat_get_active.3 \
-        man/sd_get_seats.3 \
-        man/sd_login_monitor_new.3 \
-	man/init.1
+	man/init.1 \
+        man/sd_session_get_uid.3 \
+        man/sd_session_get_seat.3 \
+        man/sd_pid_get_owner_uid.3 \
+        man/sd_uid_is_on_seat.3 \
+        man/sd_uid_get_sessions.3 \
+        man/sd_uid_get_seats.3 \
+        man/sd_seat_get_sessions.3 \
+        man/sd_seat_can_multi_session.3 \
+        man/sd_get_sessions.3 \
+        man/sd_get_uids.3 \
+        man/sd_login_monitor_unref.3 \
+        man/sd_login_monitor_flush.3 \
+        man/sd_login_monitor_get_fd.3
 
 man/reboot.8: man/halt.8
 man/poweroff.8: man/halt.8
diff --git a/man/sd-login.xml b/man/sd-login.xml
new file mode 100644
index 0000000..62ec6ff
--- /dev/null
+++ b/man/sd-login.xml
@@ -0,0 +1,117 @@
+<?xml version='1.0'?> <!--*-nxml-*-->
+<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
+        "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">
+
+<!--
+  This file is part of systemd.
+
+  Copyright 2010 Lennart Poettering
+
+  systemd is free software; you can redistribute it and/or modify it
+  under the terms of the GNU General Public License as published by
+  the Free Software Foundation; either version 2 of the License, or
+  (at your option) any later version.
+
+  systemd is distributed in the hope that it will be useful, but
+  WITHOUT ANY WARRANTY; without even the implied warranty of
+  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+  General Public License for more details.
+
+  You should have received a copy of the GNU General Public License
+  along with systemd; If not, see <http://www.gnu.org/licenses/>.
+-->
+
+<refentry id="sd-login">
+
+        <refentryinfo>
+                <title>sd-login</title>
+                <productname>systemd</productname>
+
+                <authorgroup>
+                        <author>
+                                <contrib>Developer</contrib>
+                                <firstname>Lennart</firstname>
+                                <surname>Poettering</surname>
+                                <email>lennart@poettering.net</email>
+                        </author>
+                </authorgroup>
+        </refentryinfo>
+
+        <refmeta>
+                <refentrytitle>sd-login</refentrytitle>
+                <manvolnum>7</manvolnum>
+        </refmeta>
+
+        <refnamediv>
+                <refname>sd-login</refname>
+                <refpurpose>APIs for
+                tracking logins</refpurpose>
+        </refnamediv>
+
+        <refsynopsisdiv>
+                <funcsynopsis>
+                        <funcsynopsisinfo>#include &lt;systemd/sd-login.h&gt;</funcsynopsisinfo>
+                </funcsynopsis>
+
+                <cmdsynopsis>
+                        <command>pkg-config --cflags --libs libsystemd-login</command>
+                </cmdsynopsis>
+        </refsynopsisdiv>
+
+        <refsect1>
+                <title>Description</title>
+
+                <para><filename>sd-login.h</filename> provides APIs to
+                introspect and monitor seat, login session and user
+                status information on the local system. </para>
+
+                <para>See <ulink
+                url="http://www.freedesktop.org/wiki/Software/systemd/multiseat">Multi-Seat
+                on Linux</ulink> for an introduction into multi-seat
+                support on Linux, the background for this set of APIs.</para>
+
+                <para>Note that these APIs only allow purely passive access
+                and monitoring of seats, sessions and users. To
+                actively make changes to the seat configuration,
+                terminate login sessions, or switch session on a seat
+                you need to utilize the D-Bus API of
+                systemd-logind.</para>
+
+                <para>See
+                <citerefentry><refentrytitle>sd_pid_get_session</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                <citerefentry><refentrytitle>sd_uid_get_state</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                <citerefentry><refentrytitle>sd_session_is_active</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                <citerefentry><refentrytitle>sd_seat_get_active</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                <citerefentry><refentrytitle>sd_get_seats</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                <citerefentry><refentrytitle>sd_login_monitor_new</refentrytitle><manvolnum>3</manvolnum></citerefentry>
+                for more information about the functions
+                implemented.</para>
+        </refsect1>
+
+        <refsect1>
+                <title>Notes</title>
+
+                <para>These APIs are implemented as shared library,
+                which can be compiled and linked to with the
+                <literal>libsystemd-login</literal>
+                <citerefentry><refentrytitle>pkg-config</refentrytitle><manvolnum>1</manvolnum></citerefentry>
+                file.</para>
+        </refsect1>
+
+        <refsect1>
+                <title>See Also</title>
+                <para>
+                        <citerefentry><refentrytitle>systemd</refentrytitle><manvolnum>1</manvolnum></citerefentry>,
+                        <citerefentry><refentrytitle>sd_pid_get_session</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                        <citerefentry><refentrytitle>sd_uid_get_state</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                        <citerefentry><refentrytitle>sd_session_is_active</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                        <citerefentry><refentrytitle>sd_seat_get_active</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                        <citerefentry><refentrytitle>sd_get_seats</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                        <citerefentry><refentrytitle>sd_login_monitor_new</refentrytitle><manvolnum>3</manvolnum></citerefentry>,
+                        <citerefentry><refentrytitle>sd-daemon</refentrytitle><manvolnum>7</manvolnum></citerefentry>,
+                        <citerefentry><refentrytitle>sd-readahead</refentrytitle><manvolnum>7</manvolnum></citerefentry>,
+                        <citerefentry><refentrytitle>pkg-config</refentrytitle><manvolnum>1</manvolnum></citerefentry>
+                </para>
+        </refsect1>
+
+</refentry>
diff --git a/man/sd_pid_get_session.xml b/man/sd_pid_get_session.xml
index 9176433..24e4680 100644
--- a/man/sd_pid_get_session.xml
+++ b/man/sd_pid_get_session.xml
@@ -71,16 +71,15 @@
 
                 <para><function>sd_pid_get_session()</function> may be
                 used to determine the login session identifier of a
-                process identified by the specified process identifier. The session
-                identifier is a short string (up to 64 characters),
-                consisting only of the characters a-zA-Z0-9 as well as
-                '-' and '_'. It is suitable for usage in file system
-                paths. Note that not all processes are part of a login
-                session (e.g. system service processes and user
-                processes that are shared between multiple sessions of
-                the same user). For processes not being part of a
-                login session this function will fail. The returned
-                string needs to be freed with the libc
+                process identified by the specified process
+                identifier. The session identifier is a short string,
+                suitable for usage in file system paths. Note that not
+                all processes are part of a login session (e.g. system
+                service processes and user processes that are shared
+                between multiple sessions of the same user). For
+                processes not being part of a login session this
+                function will fail. The returned string needs to be
+                freed with the libc
                 <citerefentry><refentrytitle>free</refentrytitle><manvolnum>3</manvolnum></citerefentry>
                 call after use.</para>
 
